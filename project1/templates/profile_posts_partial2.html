{% load widget_tweaks %}
{% load custom_tags %}

{% with comments_first_pages|index:forloop.counter0 as comments_first_page %}
<div class="collapse profile_comments_page" id="profile_comments_page_{{post.id}}" data-id="{{post.id}}" data-pagenum="{{comments_first_page.number}}" data-pageurl="{{post.get_absolute_url}}?page={{comments_first_page.number}}">
{% endwith %}


  <div class="page-header" id="profile_comments_page_header_{{post.id}}">
    <h4 id="profile_comments_count_{{post.id}}">{{ comments_count|index:forloop.counter0 }} {{ comment_title }}</h4>
  </div>

  {% if no_comments|index:forloop.counter0 %}
  <div id="no_comments_{{post.id}}">
    <p>There are no comments.</p>
  </div>
  {% endif %}

  {% if no_comments|index:forloop.counter0 == False %}
  <div>
    {% for comment in comments_first_pages|index:forloop.counter0 %}
    <div class="media">
      <div class="media-left">
        <a href="{% url 'profiles:profile_activity' id=comment.user.id slug=comment.user.profile.slug %}">
          <img class="media-object" src="{{ comment.user.profile.avatar.url }}" alt="..." width="64px" height="64px">
        </a>
      </div>
      <div class="media-body">
        <a class="media-heading" href="{% url 'profiles:profile_activity' id=post.user.id slug=post.user.profile.slug %}">{{ post.user.username }}</a>
        <p>{{ comment.content}} </p>
        <p>{{ comment.date_created}} </p>
      </div>
    </div>
    {% endfor %}
  </div>

  <div>
    <ul class="pagination">
      {% with comments_first_pages|index:forloop.counter0 as comments_first_page %}
      {% if comments_first_page.has_previous %}
      <li><a class="profile_comments_page_button" href="{{ post.get_absolute_url }}?page={{ comments_first_page.previous_page_number }}" >&laquo;</a></li>
      {% else %}
      <li class="disabled"><span>&laquo;</span></li>
      {% endif %}
      {% for i in comments_first_page.paginator.page_range %}
      {% if comments_first_page.number == i %}
      <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
      {% else %}
      <li><a class="profile_comments_page_button" href="{{ post.get_absolute_url }}?page={{ i }}" >{{ i }}</a></li>
      {% endif %}
      {% endfor %}
      {% if comments_first_page.has_next %}
      <li><a class="profile_comments_page_button" href="{{ post.get_absolute_url }}?page={{ comments_first_page.next_page_number }}" >&raquo;</a></li>
      {% else %}
      <li class="disabled"><span>&raquo;</span></li>
      {% endif %}
      {% endwith %}
    </ul>
  </div>
  {% endif %}

  <div class="media" id='comment_form_container_{{post.id}}'>
    <div class="media-left">
      <a href="#">
        <img class="media-object" src="/media/profile_avatar/1.jpg" alt="..." width="64px" height="64px">
      </a>
    </div>
    <div class="media-body">
      <form method="post" class="comment_form" id="comment_form_{{post.id}}" data-pagenum="1">
        {% csrf_token %}

        {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {{ form.non_field_errors }}
        </div>
        {% endif %}

        <!-- Button trigger modal -->
        <div class="form-group">
          <textarea class="form-control comment_form_textfield" id="comment_form_textfield_{{post.id}}" rows="3" placeholder="Leave a commment." required></textarea>

          {% if form.content.errors %}
          <div class="alert alert-danger" role="alert">
            {{ form.content.errors }}
          </div>
          {% endif %}
          {% if form.content.help_text %}
          <p class="help-block">{{ form.content.help_text|safe }}</p>
          {% endif %}
        </div>
        <div class="collapse" id="commentform_collapse_{{post.id}}">
          <button type="submit"class="btn btn-primary" >{{ comment_button_text }}</button>
        </div>
      </form>
    </div>
  </div>
</div>
