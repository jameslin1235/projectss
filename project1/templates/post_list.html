{% extends "base.html" %}

{% block title %}{{ title }}{% endblock title %}

{% block body %}
<section >
  <div class='container'>
    <div class="row">
      <div class='col-md-8'>
        <div class='section'>
          <div class="page-header">
            <h5><span class="glyphicon glyphicon-th-large" aria-hidden="true"></span> {{ title }}</h5>
          </div>
          {% for post in current_page %}
          <div class="thumbnail thumbnail_detail">
            <div class="caption">
              <p><a href="{{ post.category.get_absolute_url }}">{{ post.category }}</a></p>
              <h3><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
              <p><a href="{% url 'profiles:profile_activity' id=post.user.id slug=post.user.profile.slug %}">{{ post.user.username }}</a></p>
              <p>{{ post.content }}</p>
              <p><a href="{{ post.get_absolute_url }}" data-toggle="tooltip" data-placement="top" title="Published {{ post.date_published }}">Edited {{ post.date_edited }}</a></p>
              <p>
                <button type="button" class="btn btn-primary"><span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> {{ post.likes }}</button>
                <button type="button" class="btn btn-link"><span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span> {{ post.dislikes }}</button>
                <button type="button" class="btn btn-link" data-toggle="collapse" data-target="#collapseExample{{post.id}}" aria-expanded="false" aria-controls="collapseExample" ><span class="glyphicon glyphicon-comment" aria-hidden="true"></span> {{ post.comment_set.all.count }}</button>
                <button type="button" class="btn btn-link" data-container="body" data-toggle="popover" data-placement="bottom" data-content="Vivamus
                sagittis lacus vel augue laoreet rutrum faucibus."><span class="glyphicon glyphicon-share" aria-hidden="true"></span> Share</button>
                <button type="button" class="btn btn-link" data-container="body" data-toggle="popover" data-placement="bottom" data-content="Vivamus
                sagittis lacus vel augue laoreet rutrum faucibus."><span class="  glyphicon glyphicon-bookmark" aria-hidden="true"></span> Bookmark</button>
              </p>
              <div class="collapse" id="collapseExample{{post.id}}">
                <div class="page-header">
                  <h4>{{ post.comment_set.all.count }} {{ comment_title }}</h4>
                </div>

                {% if post.comment_set.all.count == 0 %}
                <div>
                  <p>There are no comments.</p>
                </div>
                {% endif %}

                {% if post.comment_set.all.count != 0 %}
                {% for comment in post.comment_set.all %}
                <div class="media">
                  <div class="media-left">
                    <a href="{% url 'profiles:profile_activity' id=comment.user.id slug=comment.user.profile.slug %}">
                      <img class="media-object" src="{{ comment.user.profile.avatar.url }}" alt="..." width="64px" height="64px">
                    </a>
                  </div>
                  <div class="media-body">
                    <h4 class="media-heading">{{ comment.user }}</h4>
                    <p>{{ comment.content}} </p>
                    <p>{{ comment.date_created}} </p>
                  </div>
                </div>
                {% endfor %}
                {% endif %}

                <div class="media">
                  <div class="media-left">
                    <a href="#">
                      <img class="media-object" src="/media/profile_avatar/1.jpg" alt="..." width="64px" height="64px">
                    </a>
                  </div>
                  <div class="media-body">
                    <form method="post">
                      {% csrf_token %}

                      {% if form.non_field_errors %}
                      <div class="alert alert-danger" role="alert">
                        {{ form.non_field_errors }}
                      </div>
                      {% endif %}

                      <div class="form-group" {% if logged_in == False %}data-toggle="modal" data-target="#myModal"{% else %}data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample"{% endif %}>


                        {{ form.content|add_class:"form-control"|attr:"placeholder:Leave a comment."|attr:"rows:3" }}
                        {% if form.content.errors %}
                        <div class="alert alert-danger" role="alert">
                          {{ form.content.errors }}
                        </div>
                        {% endif %}
                        {% if form.content.help_text %}
                        <p class="help-block">{{ form.content.help_text|safe }}</p>
                        {% endif %}
                      </div>

                      {% if logged_in %}
                      <div class="collapse" id="collapseExample">
                        <button type="submit"class="btn btn-primary" >{{ comment_button_text }}</button>
                      </div>
                      {% endif %}
                      <!-- Button trigger modal -->


                      <!-- Modal -->
                      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                              <h4 class="modal-title" id="myModalLabel">Login</h4>
                            </div>
                            <div class="modal-body" id="modal_comment_body">
                              <a class="btn btn-default" href="{% url 'login' %}?next={{request.path}}">Login</a>
                            </div>
                            <div class="modal-footer" id="modal_comment_footer">

                              <p>Don't have an account? <a href="{% url 'accounts:register' %}">Register</a></p>

                            </div>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>

              </div>

            </div>
          </div>
          {% endfor %}

          <ul class="pagination">
            {% if current_page.has_previous %}
            <li><a href="?page={{ current_page.previous_page_number }}">&laquo;</a></li>
            {% else %}
            <li class="disabled"><span>&laquo;</span></li>
            {% endif %}
            {% for i in current_page.paginator.page_range %}
            {% if current_page.number == i %}
            <li class="active"><span>{{ i }} <span class="sr-only">(current)</span></span></li>
            {% else %}
            <li><a href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
            {% endfor %}
            {% if current_page.has_next %}
            <li><a href="?page={{ current_page.next_page_number }}">&raquo;</a></li>
            {% else %}
            <li class="disabled"><span>&raquo;</span></li>
            {% endif %}
          </ul>
        </div>
      </div>
      <div class='col-md-3 col-md-offset-1'>
        <div class='section'>
          <div class="page-header">
            <h5><span class="glyphicon glyphicon-th-large" aria-hidden="true"></span> {{ title }}</h5>
          </div>
          <div class="list-group">
            <a href="#" class="list-group-item active">
              Cras justo odio
            </a>
            <a href="#" class="list-group-item">Dapibus ac facilisis in</a>
            <a href="#" class="list-group-item">Morbi leo risus</a>
            <a href="#" class="list-group-item">Porta ac consectetur ac</a>
            <a href="#" class="list-group-item">Vestibulum at eros</a>
          </div>
        </div>
      </div>
    </div>
  </div>


</section>
{% endblock body %}
