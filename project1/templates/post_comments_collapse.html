{% load widget_tweaks %}
{% load custom_tags %}
<div class="collapse ContentItem_comments">
  <div class="ContentItem_comments_topbar">
    <div class="ContentItem_comments_topbar_meta">
      <h2 class="ContentItem_comments_topbar_title"><span class="ContentItem_comments_topbar_title_comments_count">{{ comments_count }}</span> Comments</h2>

      <div class="ContentItem_comments_topbar_button">
        <button type="button" class="btn btn-plain">Link</button>
      </div>
    </div>
  </div>

  <div >
    {% for comment in current_page %}
    <div class="ContentItem_CommentItem">
      <div class="CommentItem-meta">
        <span class="CommentItem_avatar">
          <a href="{% url 'profiles:profile_activity' id=comment.user.profile.id slug=comment.user.profile.slug %}">
            <img src="{{comment.user.profile.avatar.url}}">
          </a>
        </span>
        <span><a href="{% url 'profiles:profile_activity' id=comment.user.profile.id slug=comment.user.profile.slug %}">{{comment.user.username }}</a></span>
        <span class="CommentItem-time">{{ comment.date_created|timesince }} ago</span>

      </div>
      <div class="CommentItem-content" >
        <p>{{comment.content}}</p>
      </div>
      <div class="CommentItem-actions">
        <button type="button" class="btn btn-plain CommentItem_likebtn"><span class="glyphicon glyphicon-thumbs-up Icon" aria-hidden="true"></span> <span class="CommentItem-actions_likers_count">{{ post.likes }}</span></button>
        <button type="button" class="btn btn-plain ContentItem_action"><span class="glyphicon glyphicon-thumbs-down Icon" aria-hidden="true"></span> <span class="CommentItem-actions_likers_count">{{ post.likes }}</span></button>
        <button type="button" class="btn btn-plain ContentItem_action"><span class="glyphicon glyphicon-share-alt Icon" aria-hidden="true"></span> <span class="CommentItem-actions_likers_count">{{ post.likes }}</span></button>

      </div>
    </div>
    {% endfor %}
    <div class="Pagination">
      {% if current_page.has_previous %}
      <button type="button" class="btn btn-plain Paginationbtn" data-url="{{post.get_absolute_url}}comments/?page={{ current_page.previous_page_number }}">Prev</button>
      {% endif %}
      {% for i in current_page.paginator.page_range %}
      {% if current_page.number == i %}
      <button type="button" class="btn btn-plain Paginationbtn Paginationbtn_current Paginationbtn_disabled">{{ i }}</button>
      {% else %}
      <button type="button" class="btn btn-plain Paginationbtn" data-url="{{post.get_absolute_url}}comments/?page={{ i  }}">{{ i }}</button>
      {% endif %}
      {% endfor %}
      {% if current_page.has_next %}
      <button type="button" class="btn btn-plain Paginationbtn" data-url="{{post.get_absolute_url}}comments/?page={{ current_page.next_page_number }}">Next</button>
      {% endif %}
    </ul>
  </div>
</div>

<div class="ContentItem_form">
  <form method="post" class="ContentItem_comments_form">
    {% csrf_token %}

    {% if form.non_field_errors %}
    <div class="alert alert-danger" role="alert">
      {{ form.non_field_errors }}
    </div>
    {% endif %}

    <!-- Button trigger modal -->
    <div class="form-group" >
      <textarea class="form-control ContentItem_comments_form_textfield"  placeholder="Leave a commment." required></textarea>

      {% if form.content.errors %}
      <div class="alert alert-danger" role="alert">
        {{ form.content.errors }}
      </div>
      {% endif %}
      {% if form.content.help_text %}
      <p class="help-block">{{ form.content.help_text|safe }}</p>
      {% endif %}
    </div>

    <div class="collapse ContentItem_comments_form_collapse">
      <button class="btn btn-plain ContentItem_comments_form_cancel_btn">Cancel</button>
      <button type="submit" class="btn btn-submit" >{{ submit_button_text }}</button>
    </div>
  </form>
</div>

</div>
